# Tournament Management Flow Documentation

This document describes the **end-to-end flow** of how tournaments, games, teams, and matches are managed in the system.  
It complements the schema documentation (`SCHEMA.md`) and is intended for developers building APIs or frontend features.

---

## 1. Tournament Creation

1. **Admin/Organizer** creates a `Tournament`.
2. Define:
   - General info: name, description, location, start/end dates.
   - Staff roles (`owner`, `organizer`, `manager`, `support`).
3. Add one or more `TournamentGame` entries:
   - Choose from `Game` master list (e.g., CS2, FIFA, Tekken).
   - Define rules (format, entry fee, min/max players, team-based vs solo).

‚úÖ At this point, the tournament is **ready to accept registrations**.

---

## 2. Registration

1. **Players** register into the tournament.
   - A `Registration` record is created linking `Tournament` + `User`.
2. For each `TournamentGame`, a `GameRegistration` is created:
   - **Solo mode**: `user` is set, `team` is `null`.
   - **Team mode**: `team` is set, `user` may still represent captain.
   - Payment info (`paid`, `method`) is stored here.
3. **Validation**:
   - Either `user` OR `team` must be set.
   - No duplicate registrations (`unique indexes`).

---

## 3. Team Formation

Teams can be created **before** or **after** registration:

- **Manual Teams**
  - A `User` creates a `Team` under a `TournamentGame`.
  - Captain invites members OR players request to join via `JoinRequest`.
  - When accepted, a `TeamMember` entry is added.
- **Auto-Teams (fallback)**
  - If registration closes and solo players remain:
    - System auto-generates teams (`autoGenerated = true`).
    - Assigns solo players into teams respecting `minPlayers`/`maxPlayers`.

---

## 4. Bracket Generation

Once registration closes:

1. Organizer locks teams (`locked = true`).
2. System (or admin) generates a `BracketGroup` and `Match` tree:
   - Format based on `TournamentGame.format`:
     - `single_elimination`
     - `double_elimination`
     - `round_robin`
3. Each `Match` links:
   - `tournament`, `tournamentGame`
   - `teamA`, `teamB`
   - `round`, `matchNumber`
   - Future linkage (`nextMatch` for winner/loser progression)

---

## 5. Match Management

1. **Scheduling**:
   - Organizer sets `scheduledAt`.
   - QR codes (`qr`) can be used for on-site check-in.
2. **During Match**:
   - Live events (`score`, `foul`, `pause`, etc.) appended to `Match.events`.
   - Admins can update scores.
3. **Completion**:
   - Winner/loser marked.
   - If bracketed, winner is advanced into `nextMatch`.

---

## 6. Tournament Progression

- Brackets continue until finals.
- Winners are determined **per TournamentGame** (‚ö†Ô∏è no cross-game mixing).
- Tournament status changes:
  - `upcoming` ‚Üí `ongoing` ‚Üí `completed`.

---

## 7. Clubs (Future Scope)

- Users may optionally belong to `Clubs`.
- Teams can be affiliated with a `Club`.
- Adds another layer of grouping but is **not required for current flow**.

---

## 8. Key System Rules

- ‚úÖ One `Registration` per `User` per `Tournament`.
- ‚úÖ A `User` can register solo, join/create a team, or be auto-assigned.
- ‚úÖ A `Team` belongs to **only one** `TournamentGame`.
- ‚úÖ A `Match` always belongs to **one** `TournamentGame` (no cross-game matches).
- ‚úÖ Payment is tracked at the `GameRegistration` level, not at the team level.

---

# üîÑ Typical Flow Example

1. Organizer creates a **Tournament** ‚Üí adds **TournamentGames** (CS2 5v5, FIFA 1v1).
2. Users register:
   - Ali registers solo for FIFA.
   - Hamza creates a team for CS2 and invites friends.
   - Sara registers solo for CS2.
3. Registration closes:
   - Ali stays solo ‚Üí direct competitor in FIFA.
   - Sara is auto-assigned into a CS2 team with other solos.
4. Bracket is generated:
   - FIFA has 16 solo players ‚Üí 1v1 elimination matches.
   - CS2 has 8 teams ‚Üí 5v5 double-elim bracket.
5. Matches are played:
   - Scores updated live.
   - Winners move through bracket.
6. Finals played ‚Üí Winners declared for each game.
7. Tournament marked as `completed`.
